<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Memory Mosaic</title>
  <link rel="stylesheet" href="static/style.css">

</head>

<body>
  <h1>Memory MosaicðŸ§©</h1>

  <div class="container">
    <div class="input-section">
      <input type="text" id="textInput" placeholder="e.g. My first solo trip to London">
      <button onclick="addText()">Add Text</button>
    </div>

    <div class="input-section">
      <input type="file" id="fileInput" />
      <button onclick="uploadFile()">Add Image</button>
    </div>

    <div class="input-section">
      <input type="file" id="audioInput" accept="audio/*">
      <button onclick="addAudio()">Add Audio</button>
    </div>
  </div>
  <div class="background-anim">
  <div class="puzzle-shape">ðŸ§©</div>
  <div class="puzzle-shape">ðŸ§©</div>
  <div class="puzzle-shape">ðŸ§©</div>
  <div class="puzzle-shape">ðŸ§©</div>
</div>


  <h2 style="text-align:center;">feed</h2>
  <div id="feed"></div>

  <script>
    // --- TEXT PUZZLE ---
    function createWordPuzzle(sentence, container) {
      const words = sentence.split(" ");
      const shuffled = [...words].sort(() => Math.random() - 0.5);

      container.innerHTML = "";
      const puzzle = document.createElement("div");
      puzzle.className = "puzzle-container";

      shuffled.forEach(word => {
        let span = document.createElement("span");
        span.textContent = word;
        span.className = "puzzle-word";
        span.draggable = true;

        span.addEventListener("dragstart", e => {
          e.dataTransfer.setData("draggedIndex", [...puzzle.children].indexOf(e.target));
          const crt = document.createElement("div");
          crt.style.display = "none";
          document.body.appendChild(crt);
          e.dataTransfer.setDragImage(crt, 0, 0);
        });

        span.addEventListener("dragover", e => e.preventDefault());

        span.addEventListener("drop", e => {
          e.preventDefault();
          let draggedIndex = e.dataTransfer.getData("draggedIndex");
          let targetIndex = [...puzzle.children].indexOf(e.target);

          if (draggedIndex >= 0 && targetIndex >= 0) {
            let draggedEl = puzzle.children[draggedIndex];
            puzzle.insertBefore(draggedEl, puzzle.children[targetIndex]);
          }
          checkWordAnswer(words, puzzle, result);
        });

        puzzle.appendChild(span);
      });

      const result = document.createElement("p");
      container.appendChild(puzzle);
      container.appendChild(result);
    }

    function checkWordAnswer(correctWords, puzzle, result) {
      const current = [...puzzle.children].map(s => s.textContent);
      if (JSON.stringify(current) === JSON.stringify(correctWords)) {
        result.textContent = "âœ… Correct!";
        result.style.color = "green";
      } else {
        result.textContent = "";
      }
    }

    function addText() {
      const text = document.getElementById("textInput").value.trim();
      if (!text) return;
      const feed = document.getElementById("feed");
      const item = document.createElement("div");
      item.className = "feed-item";
      item.innerHTML = "<b>TEXT â€” arrange the words</b>";
      feed.appendChild(item);
      createWordPuzzle(text, item);
    }

    // --- IMAGE PUZZLE ---
    function createImagePuzzle(url, container) {
      const grid = document.createElement("div");
      grid.className = "grid";

      let tiles = [];
      let index = 0;
      for (let row = 0; row < 3; row++) {
        for (let col = 0; col < 3; col++) {
          const tile = document.createElement("div");
          tile.className = "tile";
          tile.draggable = true;
          tile.style.backgroundImage = `url(${url})`;
          tile.style.backgroundPosition = `-${col * 100}px -${row * 100}px`;
          tile.dataset.correctIndex = index;

          // âœ… Fix disappearing issue
          tile.addEventListener("dragstart", e => {
            draggedTile = tile;
            const crt = document.createElement("div");
            crt.style.display = "none";
            document.body.appendChild(crt);
            e.dataTransfer.setDragImage(crt, 0, 0);
          });

          tiles.push(tile);
          index++;
        }
      }

      // Shuffle tiles
      tiles.sort(() => Math.random() - 0.5);
      tiles.forEach(t => grid.appendChild(t));

      let draggedTile = null;
      grid.addEventListener("dragover", e => e.preventDefault());
      grid.addEventListener("drop", e => {
        e.preventDefault();
        if (draggedTile && e.target.classList.contains("tile")) {
          let temp = document.createElement("div");
          grid.replaceChild(temp, draggedTile);
          grid.replaceChild(draggedTile, e.target);
          grid.replaceChild(e.target, temp);
        }
        checkImageAnswer(grid, result);
      });

      const result = document.createElement("p");
      container.appendChild(grid);
      container.appendChild(result);
    }

    function checkImageAnswer(grid, result) {
      const current = [...grid.children].map(tile => tile.dataset.correctIndex);
      const correct = [...current].sort((a, b) => a - b);
      if (JSON.stringify(current) === JSON.stringify(correct)) {
        result.textContent = "âœ… Correct!";
        result.style.color = "green";
      } else {
        result.textContent = "";
      }
    }

    function uploadFile() {
      const fileInput = document.getElementById("fileInput");
      const file = fileInput.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        const url = e.target.result;
        const feed = document.getElementById("feed");

        const item = document.createElement("div");
        item.className = "feed-item";
        item.innerHTML = "<b>IMAGE â€” arrange the tiles</b>";

        feed.appendChild(item);
        createImagePuzzle(url, item);
      };
      reader.readAsDataURL(file);
    }

    // Utility: scramble characters in a word
    function scrambleWord(word) {
      return word.split("").sort(() => Math.random() - 0.5).join("");
    }

    // --- AUDIO PUZZLE ---
    function createAudioPuzzle(fileUrl, container) {
      const transcript = "HELLO";  // Mock transcription
      const scrambled = scrambleWord(transcript);

      const puzzle = document.createElement("div");
      puzzle.className = "puzzle-container";

      scrambled.split("").forEach(letter => {
        let span = document.createElement("span");
        span.textContent = letter;
        span.className = "puzzle-letter";
        span.draggable = true;

        span.addEventListener("dragstart", e => {
          e.dataTransfer.setData("draggedIndex", [...puzzle.children].indexOf(e.target));
          const crt = document.createElement("div");
          crt.style.display = "none";
          document.body.appendChild(crt);
          e.dataTransfer.setDragImage(crt, 0, 0);
        });

        span.addEventListener("dragover", e => e.preventDefault());

        span.addEventListener("drop", e => {
          e.preventDefault();
          let draggedIndex = e.dataTransfer.getData("draggedIndex");
          let targetIndex = [...puzzle.children].indexOf(e.target);

          if (draggedIndex >= 0 && targetIndex >= 0) {
            let draggedEl = puzzle.children[draggedIndex];
            puzzle.insertBefore(draggedEl, puzzle.children[targetIndex]);
          }
          checkAudioAnswer(transcript, puzzle, result, fileUrl);
        });

        puzzle.appendChild(span);
      });

      const result = document.createElement("p");
      container.appendChild(puzzle);
      container.appendChild(result);
    }

    function checkAudioAnswer(answer, puzzle, result, fileUrl) {
      const current = [...puzzle.children].map(s => s.textContent).join("");
      if (current === answer) {
        result.innerHTML = "âœ… Correct! <br><audio controls src='" + fileUrl + "'></audio>";
        result.style.color = "green";
      } else {
        result.textContent = "";
      }
    }

    function addAudio() {
      const fileInput = document.getElementById("audioInput");
      if (!fileInput.files.length) return;
      const fileUrl = URL.createObjectURL(fileInput.files[0]);

      const feed = document.getElementById("feed");
      const item = document.createElement("div");
      item.className = "feed-item";
      item.innerHTML = "<b>AUDIO â€” solve to reveal the sound</b>";
      feed.appendChild(item);

      createAudioPuzzle(fileUrl, item);
    }
  </script>
</body>
</html>
